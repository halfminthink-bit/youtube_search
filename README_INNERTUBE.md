# 🚀 YouTube InnerTube API バズ動画発見ツール

## 📋 概要

YouTube InnerTube API（非公式）を使用して、**キーワードなし**で大量の動画を取得し、以下の条件でフィルタリングしてバズ動画を発見するツールです。

### フィルタリング条件

- **投稿日**: 半年以内（2025年5月12日以降）
- **チャンネル登録者数**: 10,000人未満
- **再生回数**: チャンネル登録者数の3倍以上

### データソース

1. **YouTube Trending動画** - 約200〜500件/実行
2. **YouTube ホームフィード（おすすめ）** - 約100〜300件/実行

### 出力形式

CSV形式（既存の公式API版と同じフォーマット）

```csv
動画タイトル,url,チャンネル名,再生回数,登録者数
サンプル動画タイトル,https://www.youtube.com/watch?v=abc123,チャンネル名,50000,5000
```

---

## 🔧 セットアップ

### 1. 依存ライブラリのインストール

```bash
pip install -r requirements.txt
```

### 2. 必要なライブラリ

- `innertube>=2.1.19` - InnerTube APIクライアント
- `requests>=2.31.0` - HTTPリクエスト
- `pandas>=2.0.0` - データ処理（オプション）
- `tqdm>=4.66.0` - プログレスバー

---

## 🚀 使い方

### 基本的な実行

```bash
python search_innertube.py
```

### 実行例

```bash
$ python search_innertube.py

============================================================
🚀 YouTube InnerTube API バズ動画発見ツール
============================================================

【検索条件】
  - 投稿日: 半年以内（2025年5月12日以降）
  - チャンネル登録者数: 10,000人未満
  - 再生回数: チャンネル登録者数の3倍以上

【データソース】
  - YouTube Trending動画
  - YouTube ホームフィード（おすすめ）

============================================================

🔧 InnerTube APIクライアントを初期化中...
✅ InnerTube クライアント初期化完了

============================================================
📡 ステップ1: 動画ID収集
============================================================

📊 Trending動画を取得中...
✅ Trending動画を 250 件取得しました

🏠 ホームフィード動画を取得中...
✅ ホームフィード動画を 180 件取得しました

✅ 合計 400 件の動画IDを収集（重複除去後）

============================================================
📝 ステップ2: 動画詳細情報取得
============================================================

動画詳細取得: 100%|██████████████████| 400/400 [02:00<00:00, 3.33it/s]
✅ 動画詳細取得完了: 380 件

============================================================
🔎 ステップ3: フィルタリング
============================================================

チャンネル情報取得: 100%|██████████████████| 120/120 [00:36<00:00, 3.30it/s]

📊 フィルタリング結果:
  - 総動画数: 380 件
  - 半年以内: 320 件
  - 登録者1万人未満: 80 件
  - 再生回数3倍以上（バズ動画）: 25 件

============================================================
💾 ステップ4: CSV出力
============================================================

💾 CSV出力中: youtube_innertube_results_20251112_150000.csv
✅ CSV出力完了: youtube_innertube_results_20251112_150000.csv

============================================================
🎉 完了!
============================================================
   抽出件数: 25 件
   出力ファイル: youtube_innertube_results_20251112_150000.csv
============================================================
```

---

## 📚 技術背景

### InnerTube APIとは

InnerTube APIは、YouTubeが内部的に使用しているプライベートAPIです。Web版、モバイルアプリ、TV版など、全てのYouTubeクライアントがこのAPIを使用しています。

#### メリット

- ✅ 公式APIのクオータ制限なし
- ✅ キーワードなしで動画取得可能（Trending、ホームフィード等）
- ✅ より豊富なデータにアクセス可能

#### デメリット

- ⚠️ 非公式のため利用規約上グレーゾーン
- ⚠️ 仕様変更で突然使えなくなる可能性
- ⚠️ レスポンスのパースが複雑

### 使用ライブラリ

**innertube** (PyPI)
- 最新版: 2.1.19 (2025年7月更新)
- GitHub: https://github.com/tombulled/innertube
- インストール: `pip install innertube`

---

## 🏗️ 実装仕様

### クラス構成

```python
class InnerTubeSearcher:
    """InnerTube APIを使用した動画検索クラス"""

    def __init__(self):
        """初期化 - InnerTubeクライアントを作成"""
        pass

    def fetch_trending_videos(self) -> List[str]:
        """Trending動画のIDを取得"""
        pass

    def fetch_home_feed_videos(self) -> List[str]:
        """ホームフィードの動画IDを取得"""
        pass

    def parse_video_ids(self, response: dict) -> List[str]:
        """レスポンスから動画IDを抽出"""
        pass

    def get_video_details(self, video_ids: List[str]) -> List[dict]:
        """動画の詳細情報を取得"""
        pass

    def filter_videos(self, videos: List[dict]) -> List[dict]:
        """条件に合う動画をフィルタリング"""
        pass

    def export_to_csv(self, videos: List[dict], filename: str):
        """CSV出力"""
        pass
```

### 処理フロー

1. **動画ID収集**
   - Trending動画を取得（`FEtrending`）
   - ホームフィード動画を取得（`FEwhat_to_watch`）
   - 重複削除

2. **詳細情報取得**
   - InnerTube API `player` エンドポイントで各動画の詳細を取得
   - 動画タイトル、チャンネル名、再生回数、投稿日を抽出

3. **フィルタリング**
   - 半年以内の動画
   - チャンネル登録者数 < 10,000
   - 再生回数 >= 登録者数 × 3

4. **CSV出力**
   - Excel対応（UTF-8 BOM付き）
   - タイムスタンプ付きファイル名

---

## ⚠️ 重要な注意点

### 1. 非公式APIの使用

このツールは、YouTubeの非公式APIを使用しています。以下の点にご注意ください：

- **利用規約**: YouTubeの利用規約に違反する可能性があります
- **突然の変更**: InnerTube APIの仕様が予告なく変更される可能性があります
- **アカウント制限**: 大量のリクエストを送信すると、IPアドレスがブロックされる可能性があります

### 2. レート制限

大量のリクエストを送信すると、一時的にブロックされる可能性があります。現在の実装では：

- 動画詳細取得: 0.3秒/リクエスト
- チャンネル情報取得: 0.3秒/リクエスト

### 3. 推奨事項

- **個人利用に限定**: 商用利用は避けてください
- **適度な実行頻度**: 連続実行は避け、適度な間隔を空けてください
- **データの保管**: 取得したデータは個人利用のみにとどめ、公開しないでください

### 4. トラブルシューティング

#### エラー: `innertube`ライブラリがインストールされていません

```bash
pip install innertube
```

#### エラー: 動画IDが1件も取得できませんでした

- InnerTube APIの仕様が変更された可能性があります
- `debug/` ディレクトリ内のJSONファイルを確認してください
- レスポンス構造が変わっている場合は、パーサーを修正する必要があります

#### エラー: 動画詳細が取得できませんでした

- レート制限に引っかかった可能性があります
- しばらく時間を空けてから再実行してください

---

## 📂 ファイル構成

```
youtube_search/
├── search_innertube.py          # InnerTube API版（このツール）
├── search_youtube.py            # 公式API版（既存）
├── search_youtube_buzz.py       # バズ動画発見ツール（公式API版）
├── requirements.txt             # 依存ライブラリ
├── README.md                    # メインREADME
├── README_INNERTUBE.md          # このファイル
├── debug/                       # デバッグ用レスポンス保存ディレクトリ
│   ├── trending_response.json
│   └── home_feed_response.json
└── youtube_innertube_results_*.csv  # 出力ファイル
```

---

## 🆚 公式API版との比較

| 項目 | InnerTube API版 | 公式API版 |
|------|----------------|----------|
| **クオータ制限** | なし | あり（10,000/日） |
| **キーワード検索** | 不要 | 必要 |
| **取得可能動画数** | 数百件/実行 | 50〜100件/実行 |
| **認証** | 不要 | OAuth2認証必要 |
| **利用規約** | グレーゾーン | 公式サポート |
| **仕様変更リスク** | 高い | 低い |
| **推奨用途** | 個人利用のみ | 商用利用OK |

---

## 🔮 今後の拡張案

### Phase 2: 改善（推奨）

- ⭐ 継続トークンによる大量取得（1000件以上）
- ⭐ エラーハンドリングの強化
- ⭐ 詳細なログ出力
- ⭐ プログレスバー表示（実装済み）

### Phase 3: 拡張（オプション）

- 💡 関連動画連鎖機能
- 💡 複数実行による動画DB構築
- 💡 スケジューラーによる自動実行
- 💡 データベース連携（SQLite等）

---

## 📝 ライセンス

このツールは教育目的で作成されました。非公式APIの使用により、YouTubeの利用規約に違反する可能性があるため、**個人利用のみ**にとどめてください。

---

## 🙏 謝辞

- [innertube](https://github.com/tombulled/innertube) - InnerTube APIクライアントライブラリ
- [YouTube](https://www.youtube.com/) - 動画プラットフォーム

---

## 📞 お問い合わせ

バグ報告や機能リクエストは、GitHubのIssueまでお願いします。
